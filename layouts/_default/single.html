{{ define "main" }}
<article class="post">
  <header>
    <h1>{{ .Title }}</h1>
    <p class="meta">Published: {{ .Date.Format "Jan 2, 2006" }}</p>
  </header>

  <div class="post-body">
    {{ .Content }}
  </div>

  <hr />

  <section id="commit-history" aria-labelledby="commit-history-heading">
    <h2 id="commit-history-heading">Commit history</h2>

    {{/* compute path under content/, e.g. posts/my-post */}}
    {{ $relative := replaceRE "^content/" "" .File.Path }}
    {{ $base := replaceRE "\\.md$" "" $relative }}
    {{ $jsonPath := printf "data/history/%s.json" $base }}

    {{ $history := getJSON $jsonPath }}
    {{ if $history }}
      <ul class="history-list">
        {{ range $history.commits }}
          <li class="history-item">
            <div class="history-meta">
              <strong>{{ .date }}</strong>
              &nbsp;•&nbsp;
              <span>{{ .author }}</span>
              &nbsp;•&nbsp;
              <a href="{{ .url }}" target="_blank" rel="noopener noreferrer">view commit</a>
            </div>
            <div class="history-message">{{ .message }}</div>
          </li>
        {{ end }}
      </ul>
    {{ else }}
      <p>No commit history available for this page.</p>
    {{ end }}
  </section>
</article>
{{ end }}

